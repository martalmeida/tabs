"undefined"!=typeof L&&(L.Mixin.TileLoader={_initTileLoader:function(){this._tiles={},this._tilesLoading={},this._tilesToLoad=0,this._map.on({moveend:this._updateTiles},this),this._updateTiles()},_removeTileLoader:function(){this._map.off({moveend:this._updateTiles},this),this._removeTiles()},_updateTiles:function(){if(this._map){var i=this._map.getPixelBounds(),e=this._map.getZoom(),t=this.options.tileSize;if(!(e>this.options.maxZoom||e<this.options.minZoom)){var o=new L.Point(Math.floor(i.min.x/t),Math.floor(i.min.y/t)),s=new L.Point(Math.floor(i.max.x/t),Math.floor(i.max.y/t)),n=new L.Bounds(o,s);this._addTilesFromCenterOut(n),this._removeOtherTiles(n)}}},_removeTiles:function(i){for(var e in this._tiles)this._removeTile(e)},_reloadTiles:function(){this._removeTiles(),this._updateTiles()},_removeOtherTiles:function(i){var e,t,o,s,n,l=this._map.getZoom();for(n in this._tiles)this._tiles.hasOwnProperty(n)&&(e=n.split(":"),t=parseInt(e[0],10),o=parseInt(e[1],10),s=parseInt(e[2],10),(l!==s||t<i.min.x||t>i.max.x||o<i.min.y||o>i.max.y)&&this._removeTile(n))},_removeTile:function(i){this.fire("tileRemoved",this._tiles[i]),delete this._tiles[i],delete this._tilesLoading[i]},_tileKey:function(i){return i.x+":"+i.y+":"+i.zoom},_tileShouldBeLoaded:function(i){var e=this._tileKey(i);return!(e in this._tiles||e in this._tilesLoading)},_tileLoaded:function(i,e){this._tilesToLoad--;var t=i.x+":"+i.y+":"+i.zoom;this._tiles[t]=e,delete this._tilesLoading[t],0===this._tilesToLoad&&this.fire("tilesLoaded")},getTilePos:function(i){i=new L.Point(i.x,i.y);var e=this._map._getNewTopLeftPoint(this._map.getCenter()),t=this.options.tileSize;return i.multiplyBy(t).subtract(e)},_addTilesFromCenterOut:function(i){var e,t,o,s=[],n=i.getCenter(),l=this._map.getZoom();for(e=i.min.y;e<=i.max.y;e++)for(t=i.min.x;t<=i.max.x;t++)o=new L.Point(t,e),o.zoom=l,this._tileShouldBeLoaded(o)&&s.push(o);var a=s.length;if(0!==a){for(s.sort(function(i,e){return i.distanceTo(n)-e.distanceTo(n)}),this._tilesToLoad+=a,t=0;a>t;t++){var h=s[t],r=this._tileKey(h);this._tilesLoading[r]=h,this.fire("tileAdded",h)}this.fire("tilesLoading")}}});