var WindView=function(a,b,c,d){var e={zoomLevel:0,numVectorsToDisplay:0,points:[],inds:[],barbLocation:d.barbLocation,arrowHeadSize:d.arrowHeadSize,arrowHeadAngle:d.arrowHeadAngle,vectorDensity:d.vectorDensity,color:"black",weight:1},f=function(f){var g=this;a.extend(g,e,f),g.arrowHeadAngle*=Math.PI/180,g.windfs=c.windFrameSource({barbLocation:g.barbLocation,arrowHeadSize:g.arrowHeadSize,arrowHeadAngle:g.arrowHeadAngle}),g.glOverlay=new b.WebGLVectorLayer};return f.prototype.addTo=function(b){var c=this;return c.mapView=b,c.mapView.visibleLayers.wind&&c.glOverlay.addTo(c.mapView.map),c.mapView.map.on("dragend",function(){c.redraw()}),c.mapView.map.on("zoomend",function(){c.updateNumVectorsToDisplay()}),b.layerSelectControl.addToggledOverlay("wind",c.glOverlay,"Wind"),c.resetGrid(),c},f.prototype.resetGrid=function(b){var c=this,d={datasource:c.mapView.dataSource};c.windfs.withWindGridLocations(d,function(a){c.points=a,c.updateNumVectorsToDisplay()})},f.prototype.clearCache=function(b){var c=this;c.windfs._wind_frames={}},f.prototype.redraw=function(b){var c=this;if(!c.mapView||!c.points.length)return c;var d={frame:c.mapView.currentFrame,points:c.points,mapScale:c.mapView.mapScale(),datasource:mapView.dataSource};c.windfs.withWindFrame(d,function(a){lines=[];for(var d=a.indx[Math.max(4-c.zoomLevel,1)],e=0;e<d.length;e++)lines.push(a.vectors[3*d[e]]),lines.push(a.vectors[3*d[e]+1]),lines.push(a.vectors[3*d[e]+2]);c.glOverlay.setLines2D(lines,{},"wind"),b&&b(a)})},f.prototype.updateNumVectorsToDisplay=function(){var a=this,b=a.vectorDensity,c=a.points.length,d=a.mapView.map.getZoom(),e=a.mapView.minZoom,f=Math.pow(4,d-e),g=Math.min(Math.ceil(b*f),c);a.zoomLevel=d-e,console.log("Wind show",g,"at zoom level",d),a.numVectorsToDisplay=g,a.redraw()},{windView:function(b){return new f(b)}}}(jQuery,L,Models,Config),SpeedView=function(a,b,c,d){function g(b){function c(c){var d=a.extend({},c.properties,b);return d.color=d.color||d.fillColor,d}return c}function h(a,c,d){c.clearLayers(),c.addLayer(b.geoJson(a.contours,{style:d}))}var e={speedGroup:b.geoJson(),numSpeedLevels:d.numSpeedLevels,logspaceSpeedLevels:d.logspaceSpeedLevels,contourOptions:d.contourOptions},f=function(d){var f=this;a.extend(f,e,d),f.speedfs=c.speedFrameSource()};return f.prototype.addTo=function(b){var c=this;return this.mapView=b,b.layerSelectControl.addToggledOverlay("speed",c.speedGroup,"Speed"),c.mapView.visibleLayers.speed&&c.speedGroup.addTo(b.map),this},f.prototype.redraw=function(c){var d=this;if(!d.mapView)return d;var e=a.extend({frame:d.mapView.currentFrame,datasource:d.mapView.dataSource},d.contourOptions);return d.speedfs.withSpeedFrame(e,function(a){h(a,d.speedGroup,g(e)),c&&c(a)}),d},{speedView:function(b){return new f(b)}}}(jQuery,L,Models,Config),SaltView=function(a,b,c,d){function g(b){function c(c){var d=a.extend({},c.properties,b);return d.color=d.color||d.fillColor,d}return c}function h(a,c,d){c.clearLayers(),c.addLayer(b.geoJson(a.contours,{style:d}))}var e={saltGroup:b.geoJson(),numSaltLevels:d.numSaltLevels,logspaceSaltLevels:d.logspaceSaltLevels,contourOptions:d.contourOptions},f=function(d){var f=this;a.extend(f,e,d),f.saltfs=c.saltFrameSource()};return f.prototype.addTo=function(b){var c=this;return this.mapView=b,b.layerSelectControl.addToggledOverlay("salinity",c.saltGroup,"Salinity"),c.mapView.visibleLayers.salinity&&c.saltGroup.addTo(b.map),this},f.prototype.redraw=function(c){var d=this;if(!d.mapView)return d;var e=a.extend({frame:d.mapView.currentFrame,datasource:d.mapView.dataSource},d.contourOptions);return d.saltfs.withSaltFrame(e,function(a){h(a,d.saltGroup,g(e)),c&&c(a)}),d},{saltView:function(b){return new f(b)}}}(jQuery,L,Models,Config),VelocityView=function(a,b,c,d){var e={zoomLevel:0,numVectorsToDisplay:0,points:[],inds:[],barbLocation:d.barbLocation,arrowHeadSize:d.arrowHeadSize,arrowHeadAngle:d.arrowHeadAngle,vectorDensity:d.vectorDensity,color:"black",weight:1},f=function(f){var g=this;a.extend(g,e,f),g.arrowHeadAngle*=Math.PI/180,g.velocityfs=c.velocityFrameSource({barbLocation:g.barbLocation,arrowHeadSize:g.arrowHeadSize,arrowHeadAngle:g.arrowHeadAngle}),g.glOverlay=new b.WebGLVectorLayer};return f.prototype.addTo=function(b){var c=this;return c.mapView=b,c.mapView.visibleLayers.velocity&&c.glOverlay.addTo(c.mapView.map),c.mapView.map.on("dragend",function(){console.log("dragend Velocity"),c.redraw()}),c.mapView.map.on("zoomend",function(){console.log("zoomend Velocity"),c.updateNumVectorsToDisplay()}),b.layerSelectControl.addToggledOverlay("velocity",c.glOverlay,"Velocity"),c.resetGrid(),c},f.prototype.resetGrid=function(b){var c=this,d={datasource:c.mapView.dataSource};c.velocityfs.withVelocityGridLocations(d,function(a){c.points=a,c.updateNumVectorsToDisplay()})},f.prototype.clearCache=function(b){var c=this;c.velocityfs._velocity_frames={}},f.prototype.redraw=function(b){var c=this;if(!c.mapView||!c.points.length)return c;var d={frame:c.mapView.currentFrame,points:c.points,mapScale:c.mapView.mapScale(),datasource:mapView.dataSource};c.velocityfs.withVelocityFrame(d,function(a){lines=[];for(var d=a.indx[Math.max(4-c.zoomLevel,1)],e=0;e<d.length;e++)lines.push(a.vectors[3*d[e]]),lines.push(a.vectors[3*d[e]+1]),lines.push(a.vectors[3*d[e]+2]);c.glOverlay.setLines(lines,Array(lines.length).fill(7),"velocity"),b&&b(a)})},f.prototype.updateNumVectorsToDisplay=function(){var a=this,b=a.vectorDensity,c=a.points.length,d=a.mapView.map.getZoom(),e=a.mapView.minZoom,f=Math.pow(4,d-e),g=Math.min(Math.ceil(b*f),c);a.zoomLevel=d-e,console.log("Velocity show",g,"at zoom level",d),a.numVectorsToDisplay=g,a.redraw()},{velocityView:function(b){return new f(b)}}}(jQuery,L,Models,Config),TemperatureView=function(a,b,c,d){function g(b){function c(c){var d=a.extend({},c.properties,b);return d.color=d.color||d.fillColor,d}return c}function h(a,c,d){c.clearLayers(),c.addLayer(b.geoJson(a.contours,{style:d}))}var e={temperatureGroup:b.geoJson(),numTemperatureLevels:d.numTemperatureLevels,logspaceTemperatureLevels:d.logspaceTemperatureLevels,contourOptions:d.contourOptions},f=function(d){var f=this;a.extend(f,e,d),f.tempfs=c.temperatureFrameSource()};return f.prototype.addTo=function(b){var c=this;return this.mapView=b,b.layerSelectControl.addToggledOverlay("temperature",c.temperatureGroup,"Temperature"),c.mapView.visibleLayers.temperature&&c.temperatureGroup.addTo(b.map),this},f.prototype.redraw=function(c){var d=this;if(!d.mapView)return d;var e=a.extend({frame:d.mapView.currentFrame,datasource:d.mapView.dataSource},d.contourOptions);return d.tempfs.withTemperatureFrame(e,function(a){h(a,d.temperatureGroup,g(e)),c&&c(a)}),d},{temperatureView:function(b){return new f(b)}}}(jQuery,L,Models,Config),BuoysView=function(a,b,c,d){var f={zoomLevel:0,numVectorsToDisplay:0,points:[],inds:[],barbLocation:d.barbLocation,arrowHeadSize:d.arrowHeadSize,arrowHeadAngle:d.arrowHeadAngle,vectorDensity:d.vectorDensity,color:"black",weight:1},g=function(e){var g=this;a.extend(g,f,e),g.arrowHeadAngle*=Math.PI/180,g.buoysfs=c.buoysFrameSource({barbLocation:g.barbLocation,arrowHeadSize:g.arrowHeadSize,arrowHeadAngle:g.arrowHeadAngle}),g.glOverlay=new b.WebGLVectorLayer};return g.prototype.addTo=function(b){var c=this;return c.mapView=b,c.mapView.visibleLayers.buoys&&c.glOverlay.addTo(c.mapView.map),c.mapView.map.on("dragend",function(){console.log("dragend Buoys"),c.redraw()}),c.mapView.map.on("zoomend",function(){console.log("zoomend Buoys"),c.updateNumVectorsToDisplay()}),b.layerSelectControl.addToggledOverlay("buoys",c.glOverlay,"Buoys"),c.resetGrid(),c},g.prototype.resetGrid=function(b){var c=this,d={datasource:c.mapView.dataSource};c.buoysfs.withBuoysGridLocations(d,function(a){c.points=a,c.updateNumVectorsToDisplay()})},g.prototype.clearCache=function(b){var c=this;c.buoysfs._buoys_frames={}},g.prototype.redraw=function(c){var e=this;if(!e.mapView||!e.points.length)return e;if(e.mapView.visibleLayers.buoys){e.removeBuoys();var f,g=b.icon({iconUrl:"imgs/circle.png",shadowUrl:"",iconSize:[8,8],shadowSize:[50,64],iconAnchor:[4,4],shadowAnchor:[4,62],popupAnchor:[0,-4]});f=new b.marker([25.61,-96.02],{icon:g}).bindPopup("<b>Great, excelent choise!</b>"),d.buoysMarkers.push(f),f=new b.marker([28.74,-92.99],{icon:g}).bindPopup("<p>bla bla bla</p>"),d.buoysMarkers.push(f),f=new b.marker([28.73,-89.8],{icon:g}).bindPopup("<b>Great, excelent choise!</b>"),d.buoysMarkers.push(f),f=new b.marker([27.77,-94.23],{icon:g}).bindPopup("<p>bla bla bla</p>"),d.buoysMarkers.push(f);for(var h=0;h<d.buoysMarkers.length;h++)e.mapView.map.addLayer(d.buoysMarkers[h])}else 0!=d.buoysMarkers.length&&e.removeBuoys();var i={frame:e.mapView.currentFrame,points:e.points,mapScale:e.mapView.mapScale(),datasource:mapView.dataSource};e.buoysfs.withBuoysFrame(i,function(a){lines=[];for(var b=a.indx,d=0;d<b.length;d++)lines.push(a.vectors[3*b[d]]),lines.push(a.vectors[3*b[d]+1]),lines.push(a.vectors[3*b[d]+2]);e.glOverlay.setLines2D(lines,{},"buoys"),c&&c(a)})},g.prototype.updateNumVectorsToDisplay=function(){var a=this,b=a.vectorDensity,c=a.points.length,d=a.mapView.map.getZoom(),e=a.mapView.minZoom,f=Math.pow(4,d-e),g=Math.min(Math.ceil(b*f),c);a.zoomLevel=d-e,console.log("Buoys show",g,"at zoom level",d),a.numVectorsToDisplay=g,a.redraw()},g.prototype.removeBuoys=function(){if(0!=d.buoysMarkers.length){for(var a=0;a<d.buoysMarkers.length;a++)self.mapView.map.removeLayer(d.buoysMarkers[a]);d.buoysMarkers=[]}},{buoysView:function(b){return new g(b)}}}(jQuery,L,Models,Config),RadarView=function(a,b,c,d){var e={zoomLevel:0,numVectorsToDisplay:0,points:[],inds:[],barbLocation:d.barbLocation,arrowHeadSize:d.arrowHeadSize,arrowHeadAngle:d.arrowHeadAngle,vectorDensity:d.vectorDensity,color:"black",weight:1},f=function(f){var g=this;a.extend(g,e,f),g.arrowHeadAngle*=Math.PI/180,g.radarfs=c.radarFrameSource({barbLocation:g.barbLocation,arrowHeadSize:g.arrowHeadSize,arrowHeadAngle:g.arrowHeadAngle}),g.glOverlay=new b.WebGLVectorLayer};return f.prototype.addTo=function(b){var c=this;return c.mapView=b,c.mapView.visibleLayers.radar&&c.glOverlay.addTo(c.mapView.map),c.mapView.map.on("dragend",function(){console.log("dragend radar"),c.redraw()}),c.mapView.map.on("zoomend",function(){console.log("zoomend radar"),c.updateNumVectorsToDisplay()}),b.layerSelectControl.addToggledOverlay("radar",c.glOverlay,"Radar"),c.resetGrid(),c},f.prototype.resetGrid=function(b){var c=this,d={datasource:c.mapView.dataSource};c.radarfs.withRadarGridLocations(d,function(a){c.points=a,c.updateNumVectorsToDisplay()})},f.prototype.clearCache=function(b){var c=this;c.radarfs._radar_frames={}},f.prototype.redraw=function(b){var c=this;if(!c.mapView||!c.points.length)return c;var d={frame:c.mapView.currentFrame,points:c.points,mapScale:c.mapView.mapScale(),datasource:mapView.dataSource};c.radarfs.withRadarFrame(d,function(a){lines=[];for(var d=a.indx[Math.max(3-c.zoomLevel,1)],e=0;e<d.length;e++)a.vectors[3*d[e]][0][0]==a.vectors[3*d[e]][1][0]&&a.vectors[3*d[e]][0][1]==a.vectors[3*d[e]][1][1]||(lines.push(a.vectors[3*d[e]]),lines.push(a.vectors[3*d[e]+1]),lines.push(a.vectors[3*d[e]+2]));c.glOverlay.setLines(lines,Array(lines.length).fill(7),"radar"),b&&b(a)})},f.prototype.updateNumVectorsToDisplay=function(){var a=this,b=a.vectorDensity,c=a.points.length,d=a.mapView.map.getZoom(),e=a.mapView.minZoom,f=Math.pow(4,d-e),g=Math.min(Math.ceil(b*f),c);a.zoomLevel=d-e,console.log("RadarView show",g,"at zoom level",d,"scale:",f),a.numVectorsToDisplay=g,a.redraw()},{radarView:function(b){return new f(b)}}}(jQuery,L,Models,Config);